!function(){"use strict";class e{constructor(e,t){let{items:r,renderer:n}=e;this._renderer=n,this._initialArray=r,this._container=document.querySelector(t)}renderItems(){this._initialArray.forEach(this._renderer)}addItem(e){this._container.append(e)}prependItem(e){this._container.prepend(e)}}class t{constructor(e){this._modal=document.querySelector(e),this._modalClose=this._modal.querySelector(".modal__close"),this._handleEscClose=this._handleEscClose.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}open(){window.addEventListener("keydown",this._handleEscClose),this._modal.classList.add("modal_open")}close(){this._modal.classList.remove("modal_open"),window.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._modalClose.addEventListener("click",(()=>this.close())),this._modal.addEventListener("mousedown",(e=>{e.target.classList.contains("modal_open")&&this.close()}))}}class r extends t{constructor(e){let{modalSelector:t,handleFormSubmit:r}=e;super(t),this._form=this._modal.querySelector(".modal__form"),this._handleFormSubmit=r,this._inputList=this._form.querySelectorAll(".modal__input"),this.setEventListeners()}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}reset(){this._form.reset()}close(){super.close()}}class n{constructor(e){let{data:t,selector:r,clickEventHandler:n,deleteEventHandler:o,likeEventHandler:i}=e;this._src=t.link,this._alt=t.name,this._textContent=t.name,this._likes=t.likes,this._ownerInd=t.ownerInd,this._cardLiked=t.cardLiked,this._selector=r,this._clickEventHandler=n,this._deleteEventHandler=o,this._likeEventHandler=i}_getTemplate(){return document.querySelector(this._selector).content.querySelector(".card").cloneNode(!0)}_fillImageCard(){this._cardImage.src=this._src,this._cardImage.alt=this._alt,this._cardLabel.textContent=this._textContent,this._cardLikes.textContent=this._likes}_handleDeleteCard(e){this._deleteEventHandler()}setEventListeners(){this._cardImage.addEventListener("click",(()=>{this._clickEventHandler()})),this._deleteCardButton.addEventListener("click",(e=>{this._deleteEventHandler()})),this._cardLikeButton.addEventListener("click",(e=>{this._likeEventHandler()}))}likeCard(){this._cardLikeButton.classList.add("card__heart_like"),this._cardLiked=!0}unlikeCard(){this._cardLikeButton.classList.remove("card__heart_like"),this._cardLiked=!1}isCardLiked(){return this._cardLiked}removeCardElement(){this._element.remove()}updateLikes(e){this._cardLikes.textContent=e}getCardElement(){return this._element=this._getTemplate(),this._cardImage=this._element.querySelector(".card__image"),this._cardLikeButton=this._element.querySelector(".card__heart"),this._deleteCardButton=this._element.querySelector(".card__delete"),this._cardLabel=this._element.querySelector(".card__label-text"),this._cardLikes=this._element.querySelector(".card__likes"),this._fillImageCard(),this.setEventListeners(),this._ownerInd||this._deleteCardButton.classList.add("card__delete_disable"),this._cardLiked?this.likeCard():this.unlikeCard(),this._element}}function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class i{constructor(e,t){o(this,"_showInputError",((e,t)=>{const r=this._formElement.querySelector(`#${e.id}-error`);r.textContent=t,r.classList.add(this._configDict.errorClass)})),o(this,"_hideInputError",(e=>{const t=this._formElement.querySelector(`#${e.id}-error`);t.classList.remove(this._configDict.errorClass),t.textContent=""})),o(this,"_hasInValidInput",(()=>this._inputList.some((e=>!e.validity.valid)))),o(this,"_toggleButtonState",(()=>{this._hasInValidInput()?this._disableSubmit():(this._buttonElement.classList.remove(this._configDict.inactiveButtonClass),this._buttonElement.removeAttribute("disabled",!0))})),o(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),o(this,"_disableSubmit",(()=>{this._buttonElement.setAttribute("disabled",!0),this._buttonElement.classList.add(this._configDict.inactiveButtonClass)})),o(this,"enableValidation",(()=>{this._setEventListeners()})),o(this,"resetValidation",(()=>{this._inputList.forEach((e=>{this._hideInputError(e)})),this._disableSubmit()})),this._configDict=e,this._formElement=t}_setEventListeners(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._inputList=Array.from(this._formElement.querySelectorAll(this._configDict.inputSelector)),this._buttonElement=this._formElement.querySelector(this._configDict.submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))})),this._formElement.addEventListener("reset",(()=>{this._disableSubmit()}))}}class s{constructor(e){let{baseUrl:t,token:r}=e;this._baseUrl=t,this._token=r,this._baseUrl.endsWith("/")&&(this._baseUrl=this._baseUrl.substr(0,this._baseUrl.length-1))}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:{authorization:this._token}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:{authorization:this._token}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}updateUserInfo(e,t){return t.textContent="Saving...",fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify(e)})}addNewPicture(e,t){return t.textContent="Saving...",fetch(`${this._baseUrl}/cards `,{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify(e)})}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:{authorization:this._token}})}updateLikeCard(e,t){return t?fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:{authorization:this._token}}):fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:{authorization:this._token}})}updateAvatar(e,t){return t.textContent="Saving...",fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",body:JSON.stringify(e),headers:{authorization:this._token,"Content-Type":"application/json"}})}performPromiseAll(e){return Promise.all(e)}}const a={baseUrl:"https://around.nomoreparties.co/v1/group-12",token:"51b8259d-f8d1-4b7c-b443-194620edca24"},l={formSelector:".modal__form",inputSelector:".modal__input",inputErrorSelector:".modal__input-error",submitButtonSelector:".modal__submit",inactiveButtonClass:"modal__submit_inactive",errorClass:"modal__input-error_display"},d=Array.from(document.querySelectorAll(l.formSelector)),c=document.querySelector(".profile__pen"),h=document.querySelector(".profile__name"),_=document.querySelector(".profile__name-tag"),u=document.querySelector(".profile__avatar"),m=document.querySelector(".profile__avatar-edit"),p=(document.querySelector("#avatar-edit"),document.querySelector("#profile-edit")),f=p.querySelector(".modal__form").name,v=p.querySelector("#profile-modal-name"),E=p.querySelector("#profile-modal-job"),b=document.querySelector(".profile__add-button"),k={};d.forEach((e=>{const t=new i(l,e);k[e.name]=t,t.enableValidation()}));const g=new class{constructor(e){let{nameSelector:t,jobSelector:r}=e;this._profileName=document.querySelector(t),this._profileJob=document.querySelector(r)}getUserInfo(){return{profileName:this._profileName.textContent,profileJob:this._profileJob.textContent}}setUserInfo(e,t){this._profileName.textContent=e,this._profileJob.textContent=t}}({nameSelector:".profile__name",jobSelector:".profile__name-tag"}),S=document.querySelector("#profile-edit").querySelector(".modal__submit"),L=S.textContent,y=new r({modalSelector:"#profile-edit",handleFormSubmit:e=>{new s(a).updateUserInfo({name:e["profile-modal-name"],about:e["profile-modal-job"]},S).then((e=>e.ok?e.json():Promise.reject(`Error while updating the Profile: ${e.status}`))).then((e=>{g.setUserInfo(e.name,e.about),S.textContent=L,y.close()})).catch((e=>{console.log(e),y.close()}))}});c.addEventListener("click",(function(){k[f].resetValidation(),function(){const e=g.getUserInfo();v.value=e.profileName,E.value=e.profileJob}(),y.open()}));const C=new class extends t{constructor(e){super(e),this._modalImage=this._modal.querySelector(".modal__image-expanded"),this._modalText=this._modal.querySelector(".modal__image-label"),super.setEventListeners()}open(e){let{src:t,alt:r}=e;this._modalImage.src=t,this._modalImage.alt=r,this._modalText.textContent=r,super.open()}}("#image-modal");function w(e){const t=new n({data:e,selector:"#card",clickEventHandler:()=>{C.open({src:e.link,alt:e.name})},deleteEventHandler:()=>{const n=new r({modalSelector:"#delete-card-confirmation",handleFormSubmit:()=>{new s(a).deleteCard(e.imageId).then((e=>{e.ok?(t.removeCardElement(),n.close()):console.log(`Error while deleting the card. ${e.status}`)}))}});n.open()},likeEventHandler:()=>{new s(a).updateLikeCard(e.imageId,t.isCardLiked()).then((e=>e.ok?e.json():Promise.reject(`Error while updating the likes. ${e.status}`))).then((e=>{B(e.likes)?t.likeCard():t.unlikeCard(),t.updateLikes(e.likes.length)})).catch((e=>{console.log(e)}))}});return t}const I=document.querySelector("#add-card").querySelector(".modal__submit"),q=I.textContent,x=new r({modalSelector:"#add-card",handleFormSubmit:e=>{const t={name:e["add-card-title"],link:e["add-card-image-url"]};new s(a).addNewPicture(t,I).then((e=>(console.log(q),e.ok?e.json():Promise.reject(`Error while adding new image: ${e.status}`)))).then((e=>{const t=w({name:e.name,link:e.link,ownerInd:!0,cardLiked:!1,likes:0}).getCardElement();P.prependItem(t),I.textContent=q,x.reset(),x.close()})).catch((e=>{console.log(e),x.close()}))}});b.addEventListener("click",(function(){x.open()}));const U=document.querySelector("#avatar-edit").querySelector(".modal__submit"),j=U.textContent,$=new r({modalSelector:"#avatar-edit",handleFormSubmit:e=>{const t={avatar:e["avatar-url"]};new s(a).updateAvatar(t,U).then((e=>e.ok?e.json():Promise.reject(`Error while adding new avatar: ${e.status}`))).then((t=>{!function(e){const t=u.src;u.src=e,u.onerror=()=>{u.src=t,console.log("Error: Not able to load new Avatar. Avatar unchanged!!")}}(e["avatar-url"]),U.textContent=j,$.close()})).catch((e=>{console.log(e),$.close()}))}});u.addEventListener("mouseover",(e=>{m.classList.add("profile__avatar-edit_show")})),m.addEventListener("mouseout",(e=>{m.classList.remove("profile__avatar-edit_show")})),m.addEventListener("click",(e=>{$.open()}));let P="";const A={};function B(e){for(let t=0;t<e.length;t++)if(e[t]._id==A._id)return!0;return!1}!function(){const t=[],r=new s(a).getInitialCards().then((e=>e)).catch((e=>{console.log(e)})),n=new s(a).getUserInfo().then((e=>e)).catch((e=>{console.log(e)}));new s(a).performPromiseAll([r,n]).then((r=>{A.name=r[1].name,A.about=r[1].about,A.avatar=r[1].avatar,A._id=r[1]._id,r[0].forEach((e=>{const r=A._id===e.owner._id,n=B(e.likes);t.push({name:e.name,link:e.link,likes:e.likes.length,ownerInd:r,imageId:e._id,cardLiked:n})})),function(t,r){h.textContent=t.name,_.textContent=t.about,u.src=t.avatar,u.alt=`Profile of ${t.name}`,u.onload=()=>{!function(t){P=new e({items:t,renderer:e=>{const t=w(e).getCardElement();P.addItem(t)}},".content__list"),P.renderItems()}(r)},u.onerror=()=>console.log("Error: Not able to load Avatar!!")}(A,t)}))}()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUssQ0FDaEJqTCxLQUFNakMsRUFBUWlDLEtBQ2RXLEtBQU01QyxFQUFRNEMsS0FDZEksTUFBT2hELEVBQVFnRCxNQUFNOEQsT0FDckI1RCxTQUFVQSxFQUNWNEksUUFBUzlMLEVBQVE0TSxJQUNqQnhKLFVBQVdBLEdBQ1gsSUExRlIsU0FBd0J3RSxFQUFhaUYsR0FDbkN0RCxFQUFZdEYsWUFBYzJELEVBQVkzRixLQUN0Q3VILEVBQWV2RixZQUFjMkQsRUFBWWtELE1BQ3pDckIsRUFBYzNGLElBQU04RCxFQUFZMEUsT0FDaEM3QyxFQUFjMUYsSUFBTyxjQUFhNkQsRUFBWTNGLE9BRTlDd0gsRUFBYzBELE9BQVMsTUF0RXpCLFNBQXlCTixHQUN2QlYsRUFBWSxJQUFJak4sRUFDZCxDQUNFRyxNQUFPd04sRUFDUHZOLFNBQVdxTSxJQUNULE1BQ01PLEVBRE9SLEVBQVdDLEdBQ0M5RyxpQkFDekJzSCxFQUFVcE0sUUFBUW1NLEVBQVksR0FHbEMsa0JBR0ZDLEVBQVV0TSxhQUNaLENBeURJdU4sQ0FBZ0JQLEVBQWEsRUFFL0JwRCxFQUFjZ0QsUUFBVSxJQUFNdkIsUUFBUUMsSUFBSSxtQ0FDNUMsQ0FrRklrQyxDQUFlekYsRUFBYWlGLEVBQWEsR0FFN0MsQ0FFQVMsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTZWN0aW9uIHtcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIHRoaXMuX2luaXRpYWxBcnJheSA9IGl0ZW1zO1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICB9XG5cbiAgcmVuZGVySXRlbXMoKSB7XG4gICAgdGhpcy5faW5pdGlhbEFycmF5LmZvckVhY2godGhpcy5fcmVuZGVyZXIpO1xuICB9XG5cbiAgYWRkSXRlbShlbGVtZW50KSB7XG4gICAgdGhpcy5fY29udGFpbmVyLmFwcGVuZChlbGVtZW50KTtcbiAgfVxuXG4gIHByZXBlbmRJdGVtKGVsZW1lbnQpIHtcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcbiAgfVxufVxuXG5leHBvcnQgeyBTZWN0aW9uIH07XG4iLCJjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKG1vZGFsU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9tb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobW9kYWxTZWxlY3Rvcik7XG4gICAgdGhpcy5fbW9kYWxDbG9zZSA9IHRoaXMuX21vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlXCIpO1xuICAgIC8vIEkgaGF2ZSB0byB1c2UgdGhpcyBzdG10IHRvIGhhbmRsZSB0aGUgZXNjIGtleVxuICAgIC8vIGVsc2UgdGhlIHdob2xlIHdpbmRvdyBpcyBnZXR0aW5nIGNsb3NlZC5cbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XG4gIH1cblxuICBfaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBvcGVuKCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgdGhpcy5fbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5cIik7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9tb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlblwiKTtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG5cbiAgLyoqIFRvIHRoZSByZXZpZXdlciovXG4gIC8qKlxuICAgKiBZb3Ugc3VnZ2VzdGVkIG1lIHRvIG1vdmUgdGhlIGV2ZW50IGxpc3RlbmVycyBzZXR0aW5nIHRvIG9wZW4oKVxuICAgKiBhbmQgcmVtb3ZlIHRoZSBldmVudCBsaXN0ZW5lcnMgaW4gY2xvc2UoKS5cbiAgICogSXQncyBhIGdyZWF0IHN1Z2dlc3Rpb24uIEhvd2V2ZXIsIEkgYW0gdXNpbmcgYW5vbnltb3VzIGZ1bmN0aW9uXG4gICAqIHRvIHRoZSBldmVudCBsaXN0ZW5lcnMuIERvIEkgbmVlZCB0byByZXBlYXQgdGhlIGNvZGUgYWdhaW4gaW5cbiAgICogcmVtb3ZlRXZlbnRMaXN0ZW5lcj9cbiAgICovXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX21vZGFsQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuY2xvc2UoKSk7XG5cbiAgICB0aGlzLl9tb2RhbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcbiAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5cIikpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCB7IFBvcHVwIH07XG4iLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHsgbW9kYWxTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCB9KSB7XG4gICAgc3VwZXIobW9kYWxTZWxlY3Rvcik7XG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX21vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5faW5wdXRMaXN0ID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKTtcbiAgICB0aGlzLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgZm9ybVZhbHVlcyA9IHt9O1xuXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBmb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvcm1WYWx1ZXM7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgfSk7XG4gIH1cblxuICByZXNldCgpIHtcbiAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XG4gIH1cblxuICAvKipUbyB0aGUgUmV2aWV3ZXIgKHNwcmludC04KTpcbiAgICogSSBtYWRlIGNoYW5nZXMgYXMgcGVyIHlvdXIgc3VnZ2VzdGlvbi4gUmVtb3ZlZCByZXNldCgpIGZ1bmN0aW9uLFxuICAgKiBhbmQgYWRkZWQgbGluZSB0byByZXNldCB0aGUgZm9ybSBpbiBjbG9zZSgpIGl0c2VsZi5cbiAgICogSG93ZXZlciwgaG93IGNhbiBJIGhhbmRsZSB0aGUgZnVuY3Rpb25hbGl0eSBvZiBub3QgdG9cbiAgICogcmVzZXQgdGhlIGZvcm0gKHRvIHNhdmUgdGhlIGVhcmxpZXIgdHlwZWQgZGF0YT8pLlxuICAgKiBGb3IgZXhhbXBsZSwgaW4gdGhlIG5ldyBpbWFnZXMgYWRkIGZ1bmN0aW9uYWxpdHksIGFmdGVyIHR5cGluZyB0aGUgZGF0YSxcbiAgICogaWYgdGhlIHVzZXIgY2xvc2VzIHRoZSBmb3JtLCBhbmQgdGhlbiBhZ2FpbiBjbGlja3MgdGhlIGFkZCBpbWFnZSBidXR0b24sXG4gICAqIHRoZSBvcGVuZWQgZm9ybSBzaG91bGQgcmVzdG9yZSB0aGUgZWFybGllciB0eXBlZCBkYXRhLlxuICAgKiBXaXRoIHRoZSBzdWdnZXN0ZWQgY2hhbmdlcyBJIGFtIG5vdCBhYmxlIHRvIGxvYWQgdGhlIHByZXZpb3VzbHkgdHlwZWRcbiAgICogdmFsdWVzIGZvciB0aGUgbmV3IGltYWdlIHVwbG9hZCBmb3JtLlxuICAgKi9cbiAgLypTcHJpbnQgOTogRG8gbm90IHJlc2V0IHRoZSBmb3JtIGFmdGVyIGNsb3NlLCBhcyBpdCB3aWxsIFxuICBkaXNhYmxlIHRoZSBzdWJtaXQgYnV0dG9uIGZvciB0aGUgaW1hZ2UgZGVsZXRlIHJlY29uZmlybWF0aW9uIG1vZGFsKi9cbiAgY2xvc2UoKSB7XG4gICAgc3VwZXIuY2xvc2UoKTtcbiAgICAvL3RoaXMuX2Zvcm0ucmVzZXQoKTtcbiAgfVxufVxuXG5leHBvcnQgeyBQb3B1cFdpdGhGb3JtIH07XG4iLCJjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3Ioe1xuICAgIGRhdGEsXG4gICAgc2VsZWN0b3IsXG4gICAgY2xpY2tFdmVudEhhbmRsZXIsXG4gICAgZGVsZXRlRXZlbnRIYW5kbGVyLFxuICAgIGxpa2VFdmVudEhhbmRsZXIsXG4gIH0pIHtcbiAgICB0aGlzLl9zcmMgPSBkYXRhLmxpbms7XG4gICAgdGhpcy5fYWx0ID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX3RleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICB0aGlzLl9vd25lckluZCA9IGRhdGEub3duZXJJbmQ7XG4gICAgdGhpcy5fY2FyZExpa2VkID0gZGF0YS5jYXJkTGlrZWQ7XG4gICAgdGhpcy5fc2VsZWN0b3IgPSBzZWxlY3RvcjtcbiAgICB0aGlzLl9jbGlja0V2ZW50SGFuZGxlciA9IGNsaWNrRXZlbnRIYW5kbGVyO1xuICAgIHRoaXMuX2RlbGV0ZUV2ZW50SGFuZGxlciA9IGRlbGV0ZUV2ZW50SGFuZGxlcjtcbiAgICB0aGlzLl9saWtlRXZlbnRIYW5kbGVyID0gbGlrZUV2ZW50SGFuZGxlcjtcbiAgfVxuXG4gIF9nZXRUZW1wbGF0ZSgpIHtcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9zZWxlY3RvcilcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgICAgLmNsb25lTm9kZSh0cnVlKTtcbiAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XG4gIH1cblxuICBfZmlsbEltYWdlQ2FyZCgpIHtcbiAgICB0aGlzLl9jYXJkSW1hZ2Uuc3JjID0gdGhpcy5fc3JjO1xuICAgIHRoaXMuX2NhcmRJbWFnZS5hbHQgPSB0aGlzLl9hbHQ7XG4gICAgdGhpcy5fY2FyZExhYmVsLnRleHRDb250ZW50ID0gdGhpcy5fdGV4dENvbnRlbnQ7XG4gICAgdGhpcy5fY2FyZExpa2VzLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXM7XG4gIH1cblxuICAvL19oYW5kbGVUb2dnbGVMaWtlKGV2ZW50KSB7XG4gIC8vICBldmVudC50YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2hlYXJ0X2xpa2VcIik7XG4gIC8vfVxuXG4gIF9oYW5kbGVEZWxldGVDYXJkKGV2ZW50KSB7XG4gICAgdGhpcy5fZGVsZXRlRXZlbnRIYW5kbGVyKCk7XG4gICAgLy9ldmVudC50YXJnZXQuY2xvc2VzdChcIi5jYXJkXCIpLnJlbW92ZSgpO1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9jbGlja0V2ZW50SGFuZGxlcigpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fZGVsZXRlQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgICAgLy90aGlzLl9oYW5kbGVEZWxldGVDYXJkKGV2dCk7XG4gICAgICB0aGlzLl9kZWxldGVFdmVudEhhbmRsZXIoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICAvL3RoaXMuX2hhbmRsZVRvZ2dsZUxpa2UoZXZ0KTtcbiAgICAgIC8vaWYgKCFldnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9faGVhcnRfbGlrZVwiKSkge1xuICAgICAgLy8gIHRoaXMubGlrZUNhcmQoZXZ0KTtcbiAgICAgIC8vfSBlbHNlIHtcbiAgICAgIC8vICB0aGlzLnJldmVydExpa2VDYXJkKGV2dCk7XG4gICAgICAvLyB9XG4gICAgICB0aGlzLl9saWtlRXZlbnRIYW5kbGVyKCk7XG4gICAgfSk7XG4gIH1cblxuICBsaWtlQ2FyZCgpIHtcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9faGVhcnRfbGlrZVwiKTtcbiAgICB0aGlzLl9jYXJkTGlrZWQgPSB0cnVlO1xuICB9XG5cbiAgdW5saWtlQ2FyZCgpIHtcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9faGVhcnRfbGlrZVwiKTtcbiAgICB0aGlzLl9jYXJkTGlrZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGlzQ2FyZExpa2VkKCkge1xuICAgIHJldHVybiB0aGlzLl9jYXJkTGlrZWQ7XG4gIH1cblxuICByZW1vdmVDYXJkRWxlbWVudCgpIHtcbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xuICB9XG5cbiAgdXBkYXRlTGlrZXMobGlrZXMpIHtcbiAgICB0aGlzLl9jYXJkTGlrZXMudGV4dENvbnRlbnQgPSBsaWtlcztcbiAgfVxuXG4gIGdldENhcmRFbGVtZW50KCkge1xuICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xuICAgIHRoaXMuX2NhcmRJbWFnZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19oZWFydFwiKTtcbiAgICB0aGlzLl9kZWxldGVDYXJkQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZVwiKTtcblxuICAgIHRoaXMuX2NhcmRMYWJlbCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19sYWJlbC10ZXh0XCIpO1xuICAgIHRoaXMuX2NhcmRMaWtlcyA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlc1wiKTtcbiAgICB0aGlzLl9maWxsSW1hZ2VDYXJkKCk7XG4gICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xuXG4gICAgLy8gUmVtb3ZlIHRoZSBkZWxldGUgYnV0dG9uLCBpZiB0aGUgdXNlciBpcyBub3QgdGhlIG93bmVyIG9mIHRoZVxuICAgIC8vIHBob3RvXG4gICAgaWYgKCF0aGlzLl9vd25lckluZCkge1xuICAgICAgdGhpcy5fZGVsZXRlQ2FyZEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fZGVsZXRlX2Rpc2FibGVcIik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX2NhcmRMaWtlZCkge1xuICAgICAgdGhpcy5saWtlQ2FyZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVubGlrZUNhcmQoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgfVxufVxuXG5leHBvcnQgeyBDYXJkIH07XG4iLCJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3IoY29uZmlnRGljdCwgZm9ybUVsZW1lbnQpIHtcbiAgICB0aGlzLl9jb25maWdEaWN0ID0gY29uZmlnRGljdDtcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xuICB9XG5cbiAgLy8gSW4gdGhlIGJlbG93IGZ1bmN0aW9uczpcbiAgLy8gZm9ybUVsZW1lbnQgcmVwcmVzZW50cyBhIGZvcm1cbiAgLy8gaW5wdXRFbGVtZW50IHJlcHJlc2VudHMgYSBzcGVjaWZpYyBpbnB1dCBlbGVtZW50IGluIHRoZSBmb3JtXG4gIC8vIGVycm9yTWVzc2FnZSByZXByZXNlbnRzIHRoZSBlcnJvciBtZXNzYWdlIGZvciB0aGUgY29ycmVzcG9uZGluZyBpbnB1dCBmaWVsZFxuXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcbiAgICApO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9jb25maWdEaWN0W1wiZXJyb3JDbGFzc1wiXSk7XG4gIH07XG5cbiAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcbiAgICApO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2NvbmZpZ0RpY3RbXCJlcnJvckNsYXNzXCJdKTtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICB9O1xuXG4gIF9oYXNJblZhbGlkSW5wdXQgPSAoKSA9PiB7XG4gICAgLy9pbnB1dExpc3QgaXMgYSBsaXN0IG9mIGlucHV0IGZpZWxkcyBiZWxvbmdpbmcgdG8gYSBmb3JtXG4gICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICAgIH0pO1xuICB9O1xuXG4gIF90b2dnbGVCdXR0b25TdGF0ZSA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5faGFzSW5WYWxpZElucHV0KCkpIHtcbiAgICAgIC8vIHRoaXMuX2J1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAvLyB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoXG4gICAgICAvLyB0aGlzLl9jb25maWdEaWN0W1wiaW5hY3RpdmVCdXR0b25DbGFzc1wiXVxuICAgICAgLy8gKTtcbiAgICAgIHRoaXMuX2Rpc2FibGVTdWJtaXQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFxuICAgICAgICB0aGlzLl9jb25maWdEaWN0W1wiaW5hY3RpdmVCdXR0b25DbGFzc1wiXVxuICAgICAgKTtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgfVxuICB9O1xuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkgPSAoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgLy8gaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlIGlzIGF1dG8tY3JlYXRlZCBieSB0aGUgYnJvd3NlciBiYXNlZCBvbiB0aGUgdmFsaWRhdGlvbiBlcnJvclxuICAgIC8vIGNvbnN0IGlucHV0RWxlbWVudCA9IGV2dC50YXJnZXQ7XG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9XG4gIH07XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9jb25maWdEaWN0W1wiaW5wdXRTZWxlY3RvclwiXSlcbiAgICApO1xuXG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICB0aGlzLl9jb25maWdEaWN0W1wic3VibWl0QnV0dG9uU2VsZWN0b3JcIl1cbiAgICApO1xuXG4gICAgLy8gVGhpcyBzdGF0ZW1lbnQgd2lsbCBoZWxwIHRvIHNldCB0aGUgYnV0dG9uIHN0YXRlIGFwcHJvcHJpYXRlbHksIHdoZW4gdGhlXG4gICAgLy8gcGFnZSBsb2FkcyBpbml0aWFsbHlcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuXG4gICAgLy8gWW91IG11c3QgdXNlIGFycm93IGZ1bmN0aW9uLiBJZiBub3QgdXNlZCwgd2Ugd2lsbCBnZXQgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KCkgbm90IGZvdW5kIGVycm9yXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBXaGVuZXZlciBhIGZvcm0gaXMgcmVzZXQsIHRoZSBidXR0b24gd2lsbCBiZSBkaXNhYmxlZCwgdXNpbmcgdGhlIGZvbGxvd2luZyByZXNldCBldmVudCBoYW5kbGVyLlxuICAgIC8vIEFsdGVybmF0aXZlbHkgd2UgY2FuIGRpc2FibGUgdGhlIGJ1dHRvbiB3aGVuIHRoZSBtb2RhbCBpcyBvcGVuZWQgZm9yIGRpc3BsYXkuXG4gICAgLy8gU2VlIHRoZSBmdW5jdGlvbiAoc2VlIHRoZSBmdW5jdGlvbjogaGFuZGxlQ3JlYXRlQ2FyZFN1Ym1pdChldmVudCkgaW4gaW5kZXguanMpXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2V0XCIsICgpID0+IHtcbiAgICAgIC8vIGBzZXRUaW1lb3V0YCBpcyBuZWVkZWQgdG8gd2FpdCB0aWxsIHRoZSBmb3JtIGlzIGZ1bGx5IHJlc2V0IGFuZCB0aGVuIHRvIGNhbGwgYHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKClgXG4gICAgICAvL3NldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICAvL30sIDApOyAvLyBpdOKAmXMgZW5vdWdoIHRvIHB1dCAwIG1zIGhlcmVcbiAgICAgIHRoaXMuX2Rpc2FibGVTdWJtaXQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIF9kaXNhYmxlU3VibWl0ID0gKCkgPT4ge1xuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2NvbmZpZ0RpY3RbXCJpbmFjdGl2ZUJ1dHRvbkNsYXNzXCJdKTtcbiAgfTtcblxuICBlbmFibGVWYWxpZGF0aW9uID0gKCkgPT4ge1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH07XG5cbiAgcmVzZXRWYWxpZGF0aW9uID0gKCkgPT4ge1xuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihlbGVtZW50KTtcbiAgICB9KTtcbiAgICB0aGlzLl9kaXNhYmxlU3VibWl0KCk7XG4gIH07XG59XG5cbmV4cG9ydCB7IEZvcm1WYWxpZGF0b3IgfTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgdG9rZW4gfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX3Rva2VuID0gdG9rZW47XG4gICAgaWYgKHRoaXMuX2Jhc2VVcmwuZW5kc1dpdGgoXCIvXCIpKSB7XG4gICAgICB0aGlzLl9iYXNlVXJsID0gdGhpcy5fYmFzZVVybC5zdWJzdHIoMCwgdGhpcy5fYmFzZVVybC5sZW5ndGggLSAxKTtcbiAgICB9XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl90b2tlbixcbiAgICAgIH0sXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fdG9rZW4sXG4gICAgICB9LFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlcnJvciwgcmVqZWN0IHRoZSBwcm9taXNlXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICB1cGRhdGVVc2VySW5mbyhwcm9maWxlSW5mbywgcHJvZmlsZUVkaXRTdWJtaXRCdXR0b24pIHtcbiAgICBwcm9maWxlRWRpdFN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX3Rva2VuLFxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwcm9maWxlSW5mbyksXG4gICAgfSk7XG4gIH1cblxuICBhZGROZXdQaWN0dXJlKHBpY3R1cmVJbmZvLCBhZGRDYXJkU3VibWl0QnV0dG9uKSB7XG4gICAgYWRkQ2FyZFN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzIGAsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX3Rva2VuLFxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwaWN0dXJlSW5mbyksXG4gICAgfSk7XG4gIH1cblxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX3Rva2VuLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZUxpa2VDYXJkKGNhcmRJZCwgY2FyZExpa2VkKSB7XG4gICAgaWYgKGNhcmRMaWtlZCkge1xuICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fdG9rZW4sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fdG9rZW4sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVBdmF0YXIobmV3QXZhdGFySW5mbywgYXZhdGFyRWRpdFN1Ym1pdEJ1dHRvbikge1xuICAgIGF2YXRhckVkaXRTdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KG5ld0F2YXRhckluZm8pLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl90b2tlbixcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcGVyZm9ybVByb21pc2VBbGwocHJvbWlzZUxpc3QpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZUxpc3QpO1xuICB9XG59XG5cbmV4cG9ydCB7IEFwaSB9O1xuIiwiaW1wb3J0IFwiLi4vcGFnZXMvaW5kZXguY3NzXCI7XG5cbmltcG9ydCB7IFNlY3Rpb24gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgeyBQb3B1cFdpdGhGb3JtIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xuXG5pbXBvcnQgeyBDYXJkIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xuXG5pbXBvcnQgeyBGb3JtVmFsaWRhdG9yIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuXG5pbXBvcnQgeyBQb3B1cFdpdGhJbWFnZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XG5cbmltcG9ydCB7IEFwaSB9IGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuaW1wb3J0IHsgUG9wdXAgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFwiO1xuXG5jb25zdCBhcGlPcHRpb25zID0ge1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcbiAgdG9rZW46IFwiNTFiODI1OWQtZjhkMS00YjdjLWI0NDMtMTk0NjIwZWRjYTI0XCIsXG59O1xuXG4vLyBHbG9iYWwgZGljdCBmb3IgdmFsaWRhdGlvbiBvZiBmb3JtIGVsZW1lbnRzXG5jb25zdCBjb25maWdEaWN0ID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBpbnB1dEVycm9yU2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dC1lcnJvclwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdFwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXRfaW5hY3RpdmVcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXQtZXJyb3JfZGlzcGxheVwiLFxufTtcblxuLy8gR2xvYmFsIHZhcmlhYmxlIHRvIHNlbGVjdCBhbGwgZm9ybXNcbi8vIEFsc28gY29udmVydCB0aGUgcHNldWRvIGFycmF5IHRvIG5vcm1hbCBhcnJheSB1c2luZyBBcnJheS5mcm9tKCkuXG4vLyBXaXRob3V0IHVzaW5nIEFycmF5LmZyb20oKSwgd2UgY2Fubm90IHBhcnNlIHRocm91Z2ggdGhlIGZvcm1zIHRvIGVuYWJsZVxuLy8gaW5wdXQgZmllbGQgdmFsaWRhdGlvblxuY29uc3QgYWxsRm9ybXMgPSBBcnJheS5mcm9tKFxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZ0RpY3RbXCJmb3JtU2VsZWN0b3JcIl0pXG4pO1xuXG4vLyBHbG9iYWwgdmFyaWFibGVzIHRvIHN1cHBvcnQgUHJvZmlsZSBlZGl0aW5nL3NhdmluZ1xuY29uc3QgcHJvZmlsZVBlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fcGVuXCIpO1xuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlTmFtZVRhZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZS10YWdcIik7XG5jb25zdCBwcm9maWxlQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5jb25zdCBhdmF0YXJFZGl0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItZWRpdFwiKTtcbmNvbnN0IGF2YXRhckVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWVkaXRcIik7XG5cbmNvbnN0IHByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0XCIpO1xuY29uc3QgcHJvZmlsZUZvcm1FbGVtZW50ID0gcHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBwcm9maWxlRm9ybU5hbWUgPSBwcm9maWxlRm9ybUVsZW1lbnRbXCJuYW1lXCJdO1xuY29uc3QgcHJvZmlsZU1vZGFsTmFtZUlucHV0ID0gcHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1tb2RhbC1uYW1lXCIpO1xuY29uc3QgcHJvZmlsZU1vZGFsSm9iSW5wdXQgPSBwcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLW1vZGFsLWpvYlwiKTtcblxuLy8gR2xvYmFsIHZhcmlhYmxlcyBmb3IgY2FyZCB0ZW1wbGF0ZVxuY29uc3QgY2FyZFRlbXBsYXRlSUQgPSBcIiNjYXJkXCI7XG5cbi8vIEdsb2JhbCB2YXJpYWJsZSBmb3IgYWxsIGNhcmRzIGNvbnRhaW5lclxuLy8gY29uc3QgY29udGVudExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNvbnRlbnRfX2xpc3RcIik7XG5cbi8vIEdsb2JhbCB2YXJpYWJsZXMgdG8gc3VwcG9ydCBuZXcgY2FyZCBhZGRpdGlvbiBsb2dpY1xuY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbi8vY29uc3QgYWRkQ2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZFwiKTtcblxuLy9jb25zdCBhZGRDYXJkRm9ybUVsZW1lbnQgPSBhZGRDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbi8vY29uc3QgYWRkQ2FyZEZvcm1OYW1lID0gYWRkQ2FyZEZvcm1FbGVtZW50W1wibmFtZVwiXTtcbi8vY29uc3QgY2FyZFRpdGxlID0gYWRkQ2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtdGl0bGVcIik7XG4vL2NvbnN0IGNhcmRVUkwgPSBhZGRDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1pbWFnZS11cmxcIik7XG5cbi8vIEFkZCBmb3JtcyBpbnB1dCB2YWxpZGF0b3JzXG4vLyBmb3JtVmFsaWRhdG9ycyBvYmplY3RzIHdpbGwgY29udGFpbiB0aGUgZm9ybSBuYW1lIGFzIHRoZSBrZXlcbi8vIGFuZCBGb3JtVmFsaWRhdG9yIG9iamVjdCBhcyBpdHMgdmFsdWUuXG5jb25zdCBmb3JtVmFsaWRhdG9ycyA9IHt9O1xuXG5hbGxGb3Jtcy5mb3JFYWNoKChmb3JtKSA9PiB7XG4gIGNvbnN0IGZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWdEaWN0LCBmb3JtKTtcbiAgZm9ybVZhbGlkYXRvcnNbZm9ybVtcIm5hbWVcIl1dID0gZm9ybVZhbGlkYXRvcjtcbiAgZm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG59KTtcblxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xuICBuYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWVcIixcbiAgam9iU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWUtdGFnXCIsXG59KTtcblxuY29uc3QgcHJvZmlsZUVkaXRTdWJtaXRCdXR0b24gPSBkb2N1bWVudFxuICAucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWVkaXRcIilcbiAgLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdFwiKTtcblxuY29uc3QgcHJvZmlsZUVkaXRTdWJtaXRCdXR0b25UZXh0T3JpZ2luYWwgPSBwcm9maWxlRWRpdFN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcblxuLy8gQ3JlYXRlIHByb2ZpbGVGb3JtIG9iamVjdFxuY29uc3QgcHJvZmlsZUZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gIG1vZGFsU2VsZWN0b3I6IFwiI3Byb2ZpbGUtZWRpdFwiLFxuICBoYW5kbGVGb3JtU3VibWl0OiAoaW5wdXRzKSA9PiB7XG4gICAgbmV3IEFwaShhcGlPcHRpb25zKVxuICAgICAgLnVwZGF0ZVVzZXJJbmZvKFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogaW5wdXRzW1wicHJvZmlsZS1tb2RhbC1uYW1lXCJdLFxuICAgICAgICAgIGFib3V0OiBpbnB1dHNbXCJwcm9maWxlLW1vZGFsLWpvYlwiXSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJvZmlsZUVkaXRTdWJtaXRCdXR0b25cbiAgICAgIClcbiAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKHJlc3VsdC5vaykge1xuICAgICAgICAgIHJldHVybiByZXN1bHQuanNvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcbiAgICAgICAgICAgIGBFcnJvciB3aGlsZSB1cGRhdGluZyB0aGUgUHJvZmlsZTogJHtyZXN1bHQuc3RhdHVzfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oZGF0YS5uYW1lLCBkYXRhLmFib3V0KTtcbiAgICAgICAgcHJvZmlsZUVkaXRTdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPVxuICAgICAgICAgIHByb2ZpbGVFZGl0U3VibWl0QnV0dG9uVGV4dE9yaWdpbmFsO1xuICAgICAgICBwcm9maWxlRm9ybS5jbG9zZSgpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyTWVzc2FnZSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJNZXNzYWdlKTtcbiAgICAgICAgcHJvZmlsZUZvcm0uY2xvc2UoKTtcbiAgICAgIH0pO1xuXG4gICAgLy9wcm9maWxlRm9ybS5yZXNldCgpO1xuICB9LFxufSk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbi8qIEhhbmRsZSBwcm9maWxlIHBlbiBidXR0b24gY2xpY2sgKi9cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBmaWxsIHRoZSBwcm9maWxlIGZvcm0gb25jZSB2aXNpYmxlXG5mdW5jdGlvbiBmaWxsUHJvZmlsZUZvcm0oKSB7XG4gIGNvbnN0IHByb2ZpbGUgPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICBwcm9maWxlTW9kYWxOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlLnByb2ZpbGVOYW1lO1xuICBwcm9maWxlTW9kYWxKb2JJbnB1dC52YWx1ZSA9IHByb2ZpbGUucHJvZmlsZUpvYjtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRWRpdFByb2ZpbGUoKSB7XG4gIGZvcm1WYWxpZGF0b3JzW3Byb2ZpbGVGb3JtTmFtZV0ucmVzZXRWYWxpZGF0aW9uKCk7XG4gIGZpbGxQcm9maWxlRm9ybSgpO1xuICBwcm9maWxlRm9ybS5vcGVuKCk7XG59XG5cbnByb2ZpbGVQZW4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZUVkaXRQcm9maWxlKTtcblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuLyogSGFuZGxlIGNhcmRzIGFkZGl0aW9uIGxvZ2ljICAgICAqL1xuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5jb25zdCBtb2RhbENhcmQgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIjaW1hZ2UtbW9kYWxcIik7XG5cbi8vIEZpbGwgd2l0aCBkZWZhdWx0IGNhcmRzIGluaXRpYWxseVxuLy8gKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKVxuLy8gICAgaGFuZGxlRGVsZXRlQ2FyZCwgaGFuZGxlTGlrZUNhcmQsIGhhbmRsZUV4cGFuZENhcmRcbmZ1bmN0aW9uIGNyZWF0ZUNhcmQoaXRlbSkge1xuICBjb25zdCBjYXJkID0gbmV3IENhcmQoe1xuICAgIGRhdGE6IGl0ZW0sXG4gICAgc2VsZWN0b3I6IGNhcmRUZW1wbGF0ZUlELFxuICAgIGNsaWNrRXZlbnRIYW5kbGVyOiAoKSA9PiB7XG4gICAgICBtb2RhbENhcmQub3Blbih7XG4gICAgICAgIHNyYzogaXRlbS5saW5rLFxuICAgICAgICBhbHQ6IGl0ZW0ubmFtZSxcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlRXZlbnRIYW5kbGVyOiAoKSA9PiB7XG4gICAgICBjb25zdCBkZWxldGVDYXJkQ29uZmlybWF0aW9uID0gbmV3IFBvcHVwV2l0aEZvcm0oe1xuICAgICAgICBtb2RhbFNlbGVjdG9yOiBcIiNkZWxldGUtY2FyZC1jb25maXJtYXRpb25cIixcbiAgICAgICAgaGFuZGxlRm9ybVN1Ym1pdDogKCkgPT4ge1xuICAgICAgICAgIG5ldyBBcGkoYXBpT3B0aW9ucykuZGVsZXRlQ2FyZChpdGVtLmltYWdlSWQpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5vaykge1xuICAgICAgICAgICAgICBjYXJkLnJlbW92ZUNhcmRFbGVtZW50KCk7XG4gICAgICAgICAgICAgIGRlbGV0ZUNhcmRDb25maXJtYXRpb24uY2xvc2UoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvciB3aGlsZSBkZWxldGluZyB0aGUgY2FyZC4gJHtyZXN1bHQuc3RhdHVzfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBkZWxldGVDYXJkQ29uZmlybWF0aW9uLm9wZW4oKTtcbiAgICB9LFxuICAgIGxpa2VFdmVudEhhbmRsZXI6ICgpID0+IHtcbiAgICAgIG5ldyBBcGkoYXBpT3B0aW9ucylcbiAgICAgICAgLnVwZGF0ZUxpa2VDYXJkKGl0ZW0uaW1hZ2VJZCwgY2FyZC5pc0NhcmRMaWtlZCgpKVxuICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgaWYgKHJlc3VsdC5vaykge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5qc29uKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcbiAgICAgICAgICAgICAgYEVycm9yIHdoaWxlIHVwZGF0aW5nIHRoZSBsaWtlcy4gJHtyZXN1bHQuc3RhdHVzfWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgaWYgKGNoZWNrQ2FyZExpa2UocmVzdWx0Lmxpa2VzKSkge1xuICAgICAgICAgICAgY2FyZC5saWtlQ2FyZCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYXJkLnVubGlrZUNhcmQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FyZC51cGRhdGVMaWtlcyhyZXN1bHQubGlrZXMubGVuZ3RoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJNZXNzYWdlKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyTWVzc2FnZSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gIH0pO1xuICByZXR1cm4gY2FyZDtcbn1cblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuLyogTmV3IGNhcmRzIGFkZGl0aW9uIGxvZ2ljICAgICAgICAqL1xuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuY29uc3QgYWRkQ2FyZFN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50XG4gIC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkXCIpXG4gIC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXRcIik7XG5cbmNvbnN0IGFkZENhcmRTdWJtaXRCdXR0b25UZXh0T3JpZ2luYWwgPSBhZGRDYXJkU3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xuXG4vLyBIYW5kbGUgdGhlIEFERCBidXR0b24gKHRvIGFkZCBjYXJkcylcbi8vIG1vZGFsU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXRcbmNvbnN0IGFkZENhcmRGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oe1xuICBtb2RhbFNlbGVjdG9yOiBcIiNhZGQtY2FyZFwiLFxuICBoYW5kbGVGb3JtU3VibWl0OiAoaW5wdXRzKSA9PiB7XG4gICAgY29uc3QgaXRlbSA9IHtcbiAgICAgIG5hbWU6IGlucHV0c1tcImFkZC1jYXJkLXRpdGxlXCJdLFxuICAgICAgbGluazogaW5wdXRzW1wiYWRkLWNhcmQtaW1hZ2UtdXJsXCJdLFxuICAgIH07XG5cbiAgICBuZXcgQXBpKGFwaU9wdGlvbnMpXG4gICAgICAuYWRkTmV3UGljdHVyZShpdGVtLCBhZGRDYXJkU3VibWl0QnV0dG9uKVxuICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhhZGRDYXJkU3VibWl0QnV0dG9uVGV4dE9yaWdpbmFsKTtcbiAgICAgICAgaWYgKHJlc3VsdC5vaykge1xuICAgICAgICAgIHJldHVybiByZXN1bHQuanNvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcbiAgICAgICAgICAgIGBFcnJvciB3aGlsZSBhZGRpbmcgbmV3IGltYWdlOiAke3Jlc3VsdC5zdGF0dXN9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICBjb25zdCBjYXJkID0gY3JlYXRlQ2FyZCh7XG4gICAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxuICAgICAgICAgIGxpbms6IGRhdGEubGluayxcbiAgICAgICAgICBvd25lckluZDogdHJ1ZSxcbiAgICAgICAgICBjYXJkTGlrZWQ6IGZhbHNlLFxuICAgICAgICAgIGxpa2VzOiAwLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdldENhcmRFbGVtZW50KCk7XG4gICAgICAgIGNhcmRzTGlzdC5wcmVwZW5kSXRlbShjYXJkRWxlbWVudCk7XG4gICAgICAgIGFkZENhcmRTdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBhZGRDYXJkU3VibWl0QnV0dG9uVGV4dE9yaWdpbmFsO1xuICAgICAgICBhZGRDYXJkRm9ybS5yZXNldCgpO1xuICAgICAgICBhZGRDYXJkRm9ybS5jbG9zZSgpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyTWVzc2FnZSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJNZXNzYWdlKTtcbiAgICAgICAgYWRkQ2FyZEZvcm0uY2xvc2UoKTtcbiAgICAgIH0pO1xuXG4gICAgLy9hZGRDYXJkRm9ybS5yZXNldCgpO1xuICB9LFxufSk7XG5cbmZ1bmN0aW9uIGhhbmRsZUNhcmRBZGRCdXR0b25DbGljaygpIHtcbiAgYWRkQ2FyZEZvcm0ub3BlbigpO1xufVxuXG5hZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVDYXJkQWRkQnV0dG9uQ2xpY2spO1xuXG5mdW5jdGlvbiBhZGRJbml0aWFsQ2FyZHMoaW5pdGlhbENhcmRzKSB7XG4gIGNhcmRzTGlzdCA9IG5ldyBTZWN0aW9uKFxuICAgIHtcbiAgICAgIGl0ZW1zOiBpbml0aWFsQ2FyZHMsXG4gICAgICByZW5kZXJlcjogKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgY2FyZCA9IGNyZWF0ZUNhcmQoaXRlbSk7XG4gICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZXRDYXJkRWxlbWVudCgpO1xuICAgICAgICBjYXJkc0xpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XG4gICAgICB9LFxuICAgIH0sXG4gICAgXCIuY29udGVudF9fbGlzdFwiXG4gICk7XG5cbiAgY2FyZHNMaXN0LnJlbmRlckl0ZW1zKCk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVByb2ZpbGVBdmF0YXIobmV3QXZhdGFyKSB7XG4gIGNvbnN0IG9sZEF2YXRhciA9IHByb2ZpbGVBdmF0YXIuc3JjO1xuICBwcm9maWxlQXZhdGFyLnNyYyA9IG5ld0F2YXRhcjtcblxuICBwcm9maWxlQXZhdGFyLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgcHJvZmlsZUF2YXRhci5zcmMgPSBvbGRBdmF0YXI7XG4gICAgY29uc29sZS5sb2coXCJFcnJvcjogTm90IGFibGUgdG8gbG9hZCBuZXcgQXZhdGFyLiBBdmF0YXIgdW5jaGFuZ2VkISFcIik7XG4gIH07XG59XG5cbmNvbnN0IGF2YXRhckVkaXRTdWJtaXRCdXR0b24gPSBkb2N1bWVudFxuICAucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItZWRpdFwiKVxuICAucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0XCIpO1xuXG5jb25zdCBhdmF0YXJFZGl0U3VibWl0QnV0dG9uVGV4dE9yaWdpbmFsID0gYXZhdGFyRWRpdFN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcblxuY29uc3QgdXBkYXRlQXZhdGFyRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKHtcbiAgbW9kYWxTZWxlY3RvcjogXCIjYXZhdGFyLWVkaXRcIixcbiAgaGFuZGxlRm9ybVN1Ym1pdDogKGlucHV0cykgPT4ge1xuICAgIGNvbnN0IG5ld0F2YXRhckluZm8gPSB7XG4gICAgICBhdmF0YXI6IGlucHV0c1tcImF2YXRhci11cmxcIl0sXG4gICAgfTtcblxuICAgIG5ldyBBcGkoYXBpT3B0aW9ucylcbiAgICAgIC51cGRhdGVBdmF0YXIobmV3QXZhdGFySW5mbywgYXZhdGFyRWRpdFN1Ym1pdEJ1dHRvbilcbiAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKHJlc3VsdC5vaykge1xuICAgICAgICAgIHJldHVybiByZXN1bHQuanNvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcbiAgICAgICAgICAgIGBFcnJvciB3aGlsZSBhZGRpbmcgbmV3IGF2YXRhcjogJHtyZXN1bHQuc3RhdHVzfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgdXBkYXRlUHJvZmlsZUF2YXRhcihpbnB1dHNbXCJhdmF0YXItdXJsXCJdKTtcbiAgICAgICAgYXZhdGFyRWRpdFN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IGF2YXRhckVkaXRTdWJtaXRCdXR0b25UZXh0T3JpZ2luYWw7XG4gICAgICAgIHVwZGF0ZUF2YXRhckZvcm0uY2xvc2UoKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVyck1lc3NhZ2UpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyTWVzc2FnZSk7XG4gICAgICAgIHVwZGF0ZUF2YXRhckZvcm0uY2xvc2UoKTtcbiAgICAgIH0pO1xuXG4gICAgLy9hZGRDYXJkRm9ybS5yZXNldCgpO1xuICB9LFxufSk7XG5cbmZ1bmN0aW9uIGFkZFByb2ZpbGVJbmZvKHByb2ZpbGVJbmZvLCBpbml0aWFsQ2FyZHMpIHtcbiAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBwcm9maWxlSW5mby5uYW1lO1xuICBwcm9maWxlTmFtZVRhZy50ZXh0Q29udGVudCA9IHByb2ZpbGVJbmZvLmFib3V0O1xuICBwcm9maWxlQXZhdGFyLnNyYyA9IHByb2ZpbGVJbmZvLmF2YXRhcjtcbiAgcHJvZmlsZUF2YXRhci5hbHQgPSBgUHJvZmlsZSBvZiAke3Byb2ZpbGVJbmZvLm5hbWV9YDtcblxuICBwcm9maWxlQXZhdGFyLm9ubG9hZCA9ICgpID0+IHtcbiAgICBhZGRJbml0aWFsQ2FyZHMoaW5pdGlhbENhcmRzKTtcbiAgfTtcbiAgcHJvZmlsZUF2YXRhci5vbmVycm9yID0gKCkgPT4gY29uc29sZS5sb2coXCJFcnJvcjogTm90IGFibGUgdG8gbG9hZCBBdmF0YXIhIVwiKTtcbn1cblxucHJvZmlsZUF2YXRhci5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIChldmVudCkgPT4ge1xuICBhdmF0YXJFZGl0LmNsYXNzTGlzdC5hZGQoXCJwcm9maWxlX19hdmF0YXItZWRpdF9zaG93XCIpO1xufSk7XG5cbmF2YXRhckVkaXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIChldmVudCkgPT4ge1xuICBhdmF0YXJFZGl0LmNsYXNzTGlzdC5yZW1vdmUoXCJwcm9maWxlX19hdmF0YXItZWRpdF9zaG93XCIpO1xufSk7XG5cbmF2YXRhckVkaXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xuICB1cGRhdGVBdmF0YXJGb3JtLm9wZW4oKTtcbn0pO1xuXG4vLyBwcm9maWxlQXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCAoZXZlbnQpID0+IHtcbi8vIGF2YXRhckVkaXQuY2xhc3NMaXN0LnJlbW92ZShcInByb2ZpbGVfX2F2YXRhci1lZGl0X3Nob3dcIik7XG4vLyB9KTtcblxuLy8gVGhpcyB2YXJpYWJsZSB3aWxsIGJlIHVwZGF0ZWQgaW4gYWRkSW5pdGlhbENhcmRzKCkgZnVuY3Rpb24sXG4vLyB3aGljaCB3aWxsIGJlIGNhbGxlZCBpbiB0aGUgcHJvbWlzZSwgYWZ0ZXIgdGhlIGNhcmRzIGhhdmUgYmVlbiByZWFkLlxuLy8gY2FyZHNMaXN0IGlzIHJlcXVpcmVkIGxhdGVyLCB3aGVuIHdlIGFkZCBuZXcgY2FyZHMgdG8gdGhlIHBhZ2UuXG4vLyBUaGlzIHZhcmlhYmxlIGNhbm5vdCBiZSBhIGNvbnN0LCBhcyBJIGNhbm5vdCBhc3NpZ24gYSBuZXcgdmFsdWVcblxubGV0IGNhcmRzTGlzdCA9IFwiXCI7XG5cbi8vcHJvZmlsZUluZm8gY29udGFpbnMgdGhlIHVzZXIgZGV0YWlscyAobGlrZSB0aGVpciBpZCwgbmFtZSBhbmQgYWJvdXQgaW5mbylcbi8vSXQgd2lsbCBiZSBmaWxsZWQgdmlhIGFuIEFQSSBjYWxsXG5jb25zdCBwcm9maWxlSW5mbyA9IHt9O1xuXG4vL0NoZWNrcyBpZiB0aGUgdXNlciBJRCBpcyBvbmUgb2YgdGhlIElEcyB3aG8gbGlrZWQgdGhlIHBob3RvXG5mdW5jdGlvbiBjaGVja0NhcmRMaWtlKGxpa2VzKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGlrZXMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAobGlrZXNbaV0uX2lkID09IHByb2ZpbGVJbmZvLl9pZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gbG9hZEluaXRpYWxQYWdlKCkge1xuICBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXTtcblxuICBjb25zdCBjYXJkRGF0YSA9IG5ldyBBcGkoYXBpT3B0aW9ucylcbiAgICAuZ2V0SW5pdGlhbENhcmRzKClcbiAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSk7XG5cbiAgY29uc3QgdXNlckRhdGEgPSBuZXcgQXBpKGFwaU9wdGlvbnMpXG4gICAgLmdldFVzZXJJbmZvKClcbiAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSk7XG5cbiAgbmV3IEFwaShhcGlPcHRpb25zKS5wZXJmb3JtUHJvbWlzZUFsbChbY2FyZERhdGEsIHVzZXJEYXRhXSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgcHJvZmlsZUluZm8ubmFtZSA9IHJlc3VsdFsxXS5uYW1lO1xuICAgIHByb2ZpbGVJbmZvLmFib3V0ID0gcmVzdWx0WzFdLmFib3V0O1xuICAgIHByb2ZpbGVJbmZvLmF2YXRhciA9IHJlc3VsdFsxXS5hdmF0YXI7XG4gICAgcHJvZmlsZUluZm8uX2lkID0gcmVzdWx0WzFdLl9pZDtcblxuICAgIC8vb3duZXJJbmQgd2lsbCBoZWxwIHVzIHRvIGRldGVybWluZSBpZiB0aGUgcGhvdG8gaXMgb3duZWQgYnkgdGhlIHVzZXJcbiAgICAvLyBJZiBvd25lZCBieSB0aGUgdXNlciwgd2Ugd2lsbCBhZGQgdGhlIGRlbGV0ZSBiaW4gdG8gdGhlIHBob3RvLFxuICAgIC8vIGVsc2Ugd2Ugd2lsbCBub3QgYWRkIGRlbGV0ZSBiaW4gdG8gdGhlIHBob3RvXG4gICAgcmVzdWx0WzBdLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGNvbnN0IG93bmVySW5kID0gcHJvZmlsZUluZm8uX2lkID09PSBlbGVtZW50Lm93bmVyLl9pZDtcblxuICAgICAgY29uc3QgY2FyZExpa2VkID0gY2hlY2tDYXJkTGlrZShlbGVtZW50Lmxpa2VzKTtcbiAgICAgIGluaXRpYWxDYXJkcy5wdXNoKHtcbiAgICAgICAgbmFtZTogZWxlbWVudC5uYW1lLFxuICAgICAgICBsaW5rOiBlbGVtZW50LmxpbmssXG4gICAgICAgIGxpa2VzOiBlbGVtZW50Lmxpa2VzLmxlbmd0aCxcbiAgICAgICAgb3duZXJJbmQ6IG93bmVySW5kLFxuICAgICAgICBpbWFnZUlkOiBlbGVtZW50Ll9pZCxcbiAgICAgICAgY2FyZExpa2VkOiBjYXJkTGlrZWQsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBhZGRQcm9maWxlSW5mbyhwcm9maWxlSW5mbywgaW5pdGlhbENhcmRzKTtcbiAgfSk7XG59XG5cbmxvYWRJbml0aWFsUGFnZSgpO1xuIiwiY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IG5hbWVTZWxlY3Rvciwgam9iU2VsZWN0b3IgfSkge1xuICAgIHRoaXMuX3Byb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lU2VsZWN0b3IpO1xuICAgIHRoaXMuX3Byb2ZpbGVKb2IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGpvYlNlbGVjdG9yKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBwcm9maWxlTmFtZTogdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQsXG4gICAgICBwcm9maWxlSm9iOiB0aGlzLl9wcm9maWxlSm9iLnRleHRDb250ZW50LFxuICAgIH07XG4gIH1cblxuICBzZXRVc2VySW5mbyhwcm9maWxlTmFtZSwgcHJvZmlsZUpvYikge1xuICAgIHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gcHJvZmlsZU5hbWU7XG4gICAgdGhpcy5fcHJvZmlsZUpvYi50ZXh0Q29udGVudCA9IHByb2ZpbGVKb2I7XG4gIH1cbn1cblxuZXhwb3J0IHsgVXNlckluZm8gfTtcbiIsImltcG9ydCB7IFBvcHVwIH0gZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKG1vZGFsU2VsZWN0b3IpIHtcbiAgICBzdXBlcihtb2RhbFNlbGVjdG9yKTtcbiAgICB0aGlzLl9tb2RhbEltYWdlID0gdGhpcy5fbW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtZXhwYW5kZWRcIik7XG4gICAgdGhpcy5fbW9kYWxUZXh0ID0gdGhpcy5fbW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtbGFiZWxcIik7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIG9wZW4oeyBzcmMsIGFsdCB9KSB7XG4gICAgdGhpcy5fbW9kYWxJbWFnZS5zcmMgPSBzcmM7XG4gICAgdGhpcy5fbW9kYWxJbWFnZS5hbHQgPSBhbHQ7XG4gICAgdGhpcy5fbW9kYWxUZXh0LnRleHRDb250ZW50ID0gYWx0O1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuXG5leHBvcnQgeyBQb3B1cFdpdGhJbWFnZSB9O1xuIl0sIm5hbWVzIjpbIlNlY3Rpb24iLCJjb25zdHJ1Y3RvciIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsInRoaXMiLCJfcmVuZGVyZXIiLCJfaW5pdGlhbEFycmF5IiwiX2NvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInJlbmRlckl0ZW1zIiwiZm9yRWFjaCIsImFkZEl0ZW0iLCJlbGVtZW50IiwiYXBwZW5kIiwicHJlcGVuZEl0ZW0iLCJwcmVwZW5kIiwiUG9wdXAiLCJtb2RhbFNlbGVjdG9yIiwiX21vZGFsIiwiX21vZGFsQ2xvc2UiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwiZXZ0Iiwia2V5IiwiY2xvc2UiLCJvcGVuIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsInRhcmdldCIsImNvbnRhaW5zIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9mb3JtIiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfaW5wdXRMaXN0IiwicXVlcnlTZWxlY3RvckFsbCIsIl9nZXRJbnB1dFZhbHVlcyIsImZvcm1WYWx1ZXMiLCJpbnB1dCIsIm5hbWUiLCJ2YWx1ZSIsInByZXZlbnREZWZhdWx0IiwicmVzZXQiLCJDYXJkIiwiZGF0YSIsInNlbGVjdG9yIiwiY2xpY2tFdmVudEhhbmRsZXIiLCJkZWxldGVFdmVudEhhbmRsZXIiLCJsaWtlRXZlbnRIYW5kbGVyIiwiX3NyYyIsImxpbmsiLCJfYWx0IiwiX3RleHRDb250ZW50IiwiX2xpa2VzIiwibGlrZXMiLCJfb3duZXJJbmQiLCJvd25lckluZCIsIl9jYXJkTGlrZWQiLCJjYXJkTGlrZWQiLCJfc2VsZWN0b3IiLCJfY2xpY2tFdmVudEhhbmRsZXIiLCJfZGVsZXRlRXZlbnRIYW5kbGVyIiwiX2xpa2VFdmVudEhhbmRsZXIiLCJfZ2V0VGVtcGxhdGUiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX2ZpbGxJbWFnZUNhcmQiLCJfY2FyZEltYWdlIiwic3JjIiwiYWx0IiwiX2NhcmRMYWJlbCIsInRleHRDb250ZW50IiwiX2NhcmRMaWtlcyIsIl9oYW5kbGVEZWxldGVDYXJkIiwiZXZlbnQiLCJfZGVsZXRlQ2FyZEJ1dHRvbiIsIl9jYXJkTGlrZUJ1dHRvbiIsImxpa2VDYXJkIiwidW5saWtlQ2FyZCIsImlzQ2FyZExpa2VkIiwicmVtb3ZlQ2FyZEVsZW1lbnQiLCJfZWxlbWVudCIsInVwZGF0ZUxpa2VzIiwiZ2V0Q2FyZEVsZW1lbnQiLCJGb3JtVmFsaWRhdG9yIiwiY29uZmlnRGljdCIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwiX2Zvcm1FbGVtZW50IiwiaWQiLCJfY29uZmlnRGljdCIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hhc0luVmFsaWRJbnB1dCIsIl9kaXNhYmxlU3VibWl0IiwiX2J1dHRvbkVsZW1lbnQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJfaGlkZUlucHV0RXJyb3IiLCJfc2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInNldEF0dHJpYnV0ZSIsIl9zZXRFdmVudExpc3RlbmVycyIsIkFycmF5IiwiZnJvbSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJBcGkiLCJiYXNlVXJsIiwidG9rZW4iLCJfYmFzZVVybCIsIl90b2tlbiIsImVuZHNXaXRoIiwic3Vic3RyIiwibGVuZ3RoIiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0VXNlckluZm8iLCJ1cGRhdGVVc2VySW5mbyIsInByb2ZpbGVJbmZvIiwicHJvZmlsZUVkaXRTdWJtaXRCdXR0b24iLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZE5ld1BpY3R1cmUiLCJwaWN0dXJlSW5mbyIsImFkZENhcmRTdWJtaXRCdXR0b24iLCJkZWxldGVDYXJkIiwiY2FyZElkIiwidXBkYXRlTGlrZUNhcmQiLCJ1cGRhdGVBdmF0YXIiLCJuZXdBdmF0YXJJbmZvIiwiYXZhdGFyRWRpdFN1Ym1pdEJ1dHRvbiIsInBlcmZvcm1Qcm9taXNlQWxsIiwicHJvbWlzZUxpc3QiLCJhbGwiLCJhcGlPcHRpb25zIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsImlucHV0RXJyb3JTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImVycm9yQ2xhc3MiLCJhbGxGb3JtcyIsInByb2ZpbGVQZW4iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVOYW1lVGFnIiwicHJvZmlsZUF2YXRhciIsImF2YXRhckVkaXQiLCJwcm9maWxlTW9kYWwiLCJwcm9maWxlRm9ybU5hbWUiLCJwcm9maWxlTW9kYWxOYW1lSW5wdXQiLCJwcm9maWxlTW9kYWxKb2JJbnB1dCIsImFkZENhcmRCdXR0b24iLCJmb3JtVmFsaWRhdG9ycyIsImZvcm0iLCJmb3JtVmFsaWRhdG9yIiwiZW5hYmxlVmFsaWRhdGlvbiIsInVzZXJJbmZvIiwibmFtZVNlbGVjdG9yIiwiam9iU2VsZWN0b3IiLCJfcHJvZmlsZU5hbWUiLCJfcHJvZmlsZUpvYiIsInByb2ZpbGVKb2IiLCJzZXRVc2VySW5mbyIsInByb2ZpbGVFZGl0U3VibWl0QnV0dG9uVGV4dE9yaWdpbmFsIiwicHJvZmlsZUZvcm0iLCJpbnB1dHMiLCJhYm91dCIsInJlc3VsdCIsImNhdGNoIiwiZXJyTWVzc2FnZSIsImNvbnNvbGUiLCJsb2ciLCJyZXNldFZhbGlkYXRpb24iLCJwcm9maWxlIiwiZmlsbFByb2ZpbGVGb3JtIiwibW9kYWxDYXJkIiwiX21vZGFsSW1hZ2UiLCJfbW9kYWxUZXh0IiwiY3JlYXRlQ2FyZCIsIml0ZW0iLCJjYXJkIiwiZGVsZXRlQ2FyZENvbmZpcm1hdGlvbiIsImltYWdlSWQiLCJjaGVja0NhcmRMaWtlIiwiYWRkQ2FyZFN1Ym1pdEJ1dHRvblRleHRPcmlnaW5hbCIsImFkZENhcmRGb3JtIiwiY2FyZEVsZW1lbnQiLCJjYXJkc0xpc3QiLCJhdmF0YXJFZGl0U3VibWl0QnV0dG9uVGV4dE9yaWdpbmFsIiwidXBkYXRlQXZhdGFyRm9ybSIsImF2YXRhciIsIm5ld0F2YXRhciIsIm9sZEF2YXRhciIsIm9uZXJyb3IiLCJ1cGRhdGVQcm9maWxlQXZhdGFyIiwiaSIsIl9pZCIsImluaXRpYWxDYXJkcyIsImNhcmREYXRhIiwiZXJyIiwidXNlckRhdGEiLCJvd25lciIsInB1c2giLCJvbmxvYWQiLCJhZGRJbml0aWFsQ2FyZHMiLCJhZGRQcm9maWxlSW5mbyIsImxvYWRJbml0aWFsUGFnZSJdLCJzb3VyY2VSb290IjoiIn0=